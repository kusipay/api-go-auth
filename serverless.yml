service: api-go-auth

frameworkVersion: "3"

provider:
  name: aws
  runtime: provided.al2
  architecture: arm64
  region: ${env:AWS_REGION}
  stage: ${env:STAGE}
  httpApi:
    cors: true
    name: ${self:service}-${self:provider.stage}-api

package:
  individually: true

custom:
  version: "v1"
  prefix: ${self:service}-${self:provider.stage}

resources:
  Resources:
    UserPool:
      Type: AWS::Cognito::UserPool
      Properties:
        UserPoolName: ${self:custom.prefix}-userpool
        AccountRecoverySetting:
          RecoveryMechanisms:
            - Name: verified_email ## admin-only
              Priority: 1
        AdminCreateUserConfig:
          AllowAdminCreateUserOnly: true
        DeletionProtection: INACTIVE
        MfaConfiguration: "OFF"
        UsernameConfiguration:
          CaseSensitive: false

  Outputs:
    UserPoolId:
      Description: "User Pool Id"
      Value: !Ref UserPool
      Export:
        Name: ${self:custom.prefix}-userpoolid
    UserPoolArn:
      Description: "User Pool ARN"
      Value: !GetAtt UserPool.Arn
      Export:
        Name: ${self:custom.prefix}-userpoolarn
    UserPoolProviderName:
      Description: "User Pool Provider Name"
      Value: !GetAtt UserPool.ProviderName
      Export:
        Name: ${self:custom.prefix}-userpoolprovidername
    UserPoolProviderURL:
      Description: "User Pool Provider URL"
      Value: !GetAtt UserPool.ProviderURL
      Export:
        Name: ${self:custom.prefix}-userpoolproviderurl
